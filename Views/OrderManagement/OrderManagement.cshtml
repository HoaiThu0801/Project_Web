@using Project_Web.Models;
@using System.Data;
@{
    ViewBag.Title = "Quản lý đơn hàng";
    Database_PorridgeSellingManagementStoreEntities _db = new Database_PorridgeSellingManagementStoreEntities();
    User user = new User();
    user = Session["User"] as User;
    List<Bill> Model = new List<Bill>();
    string input = "";
    if (Session["Search"] != null)
    {
        List<Bill> bill = Session["Search"] as List<Bill>;
        Model = bill;
        input = Session["InputSearch"] as string;
    }
    else
    {
        Model = (from s in _db.Bills
                 select s).ToList();
    }
    Session.Remove("Search");
    Session.Remove("InputSearch");
}
<head>
    <link rel="stylesheet" type="text/css" href="~/Content/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="~/Content/OrderManagement.css">
</head>
<body>
    <div class="header">
        <div class="row">
            <div class="col-md-4">
                <a href="/Home/Index"><img src="~/images/logo.gif" class="image-logo" /></a>
            </div>
            <div class="col-md-4">
                <h2 class="text-center">Cửa hàng bán cháo | Trạng thái </h2>
            </div>
            <div class="col-md-4 progress-bar-design">
                <ul class="progressbar">
                    <li class="active">Chờ chuẩn bị</li>
                    <li>Đang giao</li>
                    <li>Đã thanh toán</li>
                    <li>Đã hoàn thành</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="main">
        <section class="signup">
            <div class="container">
                <div class="signup-content">
                    <div class="tab">
                        <button class="tablinks active" onclick="openOrder(event, 'All')">Tất cả</button>
                        <button class="tablinks" onclick="openOrder(event, 'Preparing')">Chờ chuân bị</button>
                        <button class="tablinks" onclick="openOrder(event, 'Delivering')">Đang giao</button>
                        <button class="tablinks" onclick="openOrder(event, 'Paid')">Đã thanh toán</button>
                        <button class="tablinks" onclick="openOrder(event, 'Completion')">Đã hoàn thành</button>
                        <button class="tablinks" onclick="openOrder(event, 'Cancelleation')">Đã hủy</button>
                        <button class="tablinks" onclick="openOrder(event, 'Refund')">Trả hàng/Hoàn tiền</button>
                    </div>

                    <!--Tab Tất cả-->
                    <div class="tabcontent" id="All" style="display: block">
                        <div class="tabcontent-top-search">
                            <div class="tabcontent-container">
                                <div class="search-border">
                                    <i class="fa fa-search"></i>
                                    @{

                                        if (input != null)
                                        {
                                            <input class="search" type="text" placeholder="Tìm theo tên sản phẩm, ID đơn hàng" value="@input" />
                                        }
                                        else
                                        {
                                            <input class="search" type="text" placeholder="Tìm theo tên sản phẩm, ID đơn hàng" />
                                        }
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="tabcontent-all-bottom">
                            <div class="tabcontent-all-bottom-products">
                                @{
                                    if (user != null)
                                    {
                                        var role = _db.User_Roles.SingleOrDefault(n => n.IDUser == user.IDUser);
                                        //Administrator
                                        if (role.IDRole == "R01")
                                        {
                                            foreach (var s in Model)
                                            {
                                                <div class="tabcontent-all-bottom-left">
                                                    <table>
                                                        <thead>
                                                            <tr>
                                                                <th style="width: 30% "><i class="fa fa-info-circle"></i>Thông tin sản phẩm</th>
                                                                <th style="width: 10% ">Tổng đơn hàng</th>
                                                                <th style="width: 22.5% ">Trạng thái</th>
                                                                <th style="width: 22.5% ">Vận chuyển</th>
                                                                <th style="width: 15% ">Thao tác</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <tr>
                                                                @{
                                                                    var BillDetails = (from bd in _db.BillDetails
                                                                                       where bd.IDBill == s.IDBill
                                                                                       select bd).ToList();
                                                                    foreach (var bd in BillDetails)
                                                                    {
                                                                        var dish = _db.Menus.SingleOrDefault(n => n.DishName == bd.DishName);
                                                                        if (dish != null)
                                                                        {
                                                                            <td class="display-infor">
                                                                                <img src="../@dish.Image" />
                                                                                <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                            </td>
                                                                        }
                                                                        else
                                                                        {
                                                                            <td class="display-infor">
                                                                                <img src="~/images/chao-hanh.jpg" />
                                                                                <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                            </td>
                                                                        }
                                                                    }
                                                                    var orderState = (from os in _db.OrderStates
                                                                                      join ot in _db.OrderTracks on os.IDOrderStatse equals ot.IDOrderStatse
                                                                                      where ot.IDBill == s.IDBill
                                                                                      select os.StateName).SingleOrDefault();
                                                                    <td class="text-center">@s.Total</td>
                                                                    <td class="text-center">@orderState</td>
                                                                    <td class="text-center">Giao tiêu chuẩn</td>
                                                                    <td class="text-center">
                                                                        <a href="/OrderManagement/InformationProducts" class="detail">Xem chi tiết</a>
                                                                        <button class="button-sale">Mua lần nữa</button>
                                                                    </td>
                                                                }
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                    @{
                                                        var usertemp = (from u in _db.Users
                                                                        where u.IDUser == s.IDUser
                                                                        select u).SingleOrDefault();
                                                        <div class="table-top">
                                                            <div class="table-top-user"><i class="fa fa-user-circle-o">@usertemp.Username</i></div>
                                                            <div class="table-top-products">@s.IDBill</div>
                                                        </div>
                                                    }
                                                </div>
                                            }
                                        }
                                        //Seller
                                        else if (role.IDRole == "R02")
                                        {
                                            foreach (var s in Model)
                                            {
                                                var store = (from sto in _db.Stores
                                                             where sto.IDStore == s.IDStore && user.IDUser == sto.IDUser
                                                             select sto).SingleOrDefault();
                                                if (store != null)
                                                {
                                                    <div class="tabcontent-all-bottom-left">
                                                        <table>
                                                            <thead>
                                                                <tr>
                                                                    <th style="width: 30% "><i class="fa fa-info-circle"></i>Thông tin sản phẩm</th>
                                                                    <th style="width: 10% ">Tổng đơn hàng</th>
                                                                    <th style="width: 22.5% ">Trạng thái</th>
                                                                    <th style="width: 22.5% ">Vận chuyển</th>
                                                                    <th style="width: 15% ">Thao tác</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr>
                                                                    @{
                                                                        var BillDetails = (from bd in _db.BillDetails
                                                                                           where bd.IDBill == s.IDBill
                                                                                           select bd).ToList();
                                                                        foreach (var bd in BillDetails)
                                                                        {
                                                                            var dish = _db.Menus.SingleOrDefault(n => n.DishName == bd.DishName);
                                                                            if (dish != null)
                                                                            {
                                                                                <td class="display-infor">
                                                                                    <img src="../@dish.Image" />
                                                                                    <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                </td>
                                                                            }
                                                                            else
                                                                            {
                                                                                <td class="display-infor">
                                                                                    <img src="~/images/chao-hanh.jpg" />
                                                                                    <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                </td>
                                                                            }
                                                                        }
                                                                        var orderState = (from os in _db.OrderStates
                                                                                          join ot in _db.OrderTracks on os.IDOrderStatse equals ot.IDOrderStatse
                                                                                          where ot.IDBill == s.IDBill
                                                                                          select os.StateName).SingleOrDefault();
                                                                        <td class="text-center">@s.Total</td>
                                                                        <td class="text-center">@orderState</td>
                                                                        <td class="text-center">Giao tiêu chuẩn</td>
                                                                        <td class="text-center">
                                                                            <a href="/OrderManagement/InformationProducts" class="detail">Xem chi tiết</a>
                                                                            <button class="button-sale">Mua lần nữa</button>
                                                                        </td>
                                                                    }
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                        @{
                                                            var usertemp = (from u in _db.Users
                                                                            where u.IDUser == s.IDUser
                                                                            select u).SingleOrDefault();
                                                            <div class="table-top">
                                                                <div class="table-top-user"><i class="fa fa-user-circle-o">@usertemp.Username</i></div>
                                                                <div class="table-top-products">@s.IDBill</div>
                                                            </div>
                                                        }
                                                    </div>
                                                }
                                            }
                                        }
                                        //Customers
                                        else if (role.IDRole == "R03")
                                        {
                                            foreach (var s in Model)
                                            {
                                                if (s.IDUser == user.IDUser)
                                                {
                                                    <div class="tabcontent-all-bottom-left">
                                                        <table>
                                                            <thead>
                                                                <tr>
                                                                    <th style="width: 30% "><i class="fa fa-info-circle"></i>Thông tin sản phẩm</th>
                                                                    <th style="width: 10% ">Tổng đơn hàng</th>
                                                                    <th style="width: 30% ">Trạng thái</th>
                                                                    <th style="width: 15% ">Vận chuyển</th>
                                                                    <th style="width: 15% ">Thao tác</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr>
                                                                    @{
                                                                        var billDetails = (from bd in _db.BillDetails
                                                                                           where bd.IDBill == s.IDBill
                                                                                           select bd).ToList();
                                                                        foreach (var bd in billDetails)
                                                                        {
                                                                            var dish = _db.Menus.SingleOrDefault(n => n.DishName == bd.DishName);
                                                                            if (dish != null)
                                                                            {
                                                                                <td class="display-infor">
                                                                                    <img src="../@dish.Image" />
                                                                                    <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                </td>
                                                                            }
                                                                            else
                                                                            {
                                                                                <td class="display-infor">
                                                                                    <img src="~/images/chao-hanh.jpg" />
                                                                                    <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                </td>
                                                                            }
                                                                        }
                                                                        var orderState = (from os in _db.OrderStates
                                                                                          join ot in _db.OrderTracks on os.IDOrderStatse equals ot.IDOrderStatse
                                                                                          where ot.IDBill == s.IDBill
                                                                                          select os.StateName).SingleOrDefault();
                                                                        <td class="text-center">@s.Total</td>
                                                                        <td class="text-center">@orderState</td>
                                                                        <td class="text-center">Giao tiêu chuẩn</td>
                                                                        <td class="text-center">
                                                                            <a href="/OrderManagement/InformationProducts" class="detail">Xem chi tiết</a>
                                                                            <button class="button-sale">Mua lần nữa</button>
                                                                            <button class="button-sale">Hủy</button>
                                                                        </td>
                                                                    }
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                        <div class="table-top">
                                                            <div class="table-top-user"><i class="fa fa-user-circle-o">@user.Username</i></div>
                                                            <div class="table-top-products">@s.IDBill</div>
                                                        </div>
                                                    </div>
                                                }
                                            }
                                        }
                                    }
                                }
                            </div>
                        </div>
                    </div>
                    <!--Tab Chờ Chuẩn bị-->
                    <div class="tabcontent" id="Preparing">
                        <div class="tabcontent-top-search">
                            <div class="tabcontent-container">
                                <div class="search-border">
                                    <i class="fa fa-search"></i>
                                    @{

                                        if (input != null)
                                        {
                                            <input class="search" type="text" placeholder="Tìm theo tên sản phẩm, ID đơn hàng" value="@input" />
                                        }
                                        else
                                        {
                                            <input class="search" type="text" placeholder="Tìm theo tên sản phẩm, ID đơn hàng" />
                                        }
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="tabcontent-all-bottom">
                            <div class="tabcontent-all-bottom-products">
                                @{
                                    if (user != null)
                                    {
                                        var role = _db.User_Roles.SingleOrDefault(n => n.IDUser == user.IDUser);
                                        //Administrator
                                        if (role.IDRole == "R01")
                                        {
                                            foreach (var s in Model)
                                            {
                                                OrderTrack orderTrack = _db.OrderTracks.SingleOrDefault(n => n.IDBill == s.IDBill && n.IDOrderStatse == "OS-02");
                                                if (orderTrack != null)
                                                {
                                                    <div class="tabcontent-all-bottom-left">
                                                        <table>
                                                            <thead>
                                                                <tr>
                                                                    <th style="width: 30% "><i class="fa fa-info-circle"></i>Thông tin sản phẩm</th>
                                                                    <th style="width: 10% ">Tổng đơn hàng</th>
                                                                    <th style="width: 22.5% ">Trạng thái</th>
                                                                    <th style="width: 22.5% ">Vận chuyển</th>
                                                                    <th style="width: 15% ">Thao tác</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr>
                                                                    @{
                                                                        var BillDetails = (from bd in _db.BillDetails
                                                                                           where bd.IDBill == s.IDBill
                                                                                           select bd).ToList();
                                                                        foreach (var bd in BillDetails)
                                                                        {
                                                                            var dish = _db.Menus.SingleOrDefault(n => n.DishName == bd.DishName);
                                                                            if (dish != null)
                                                                            {
                                                                                <td class="display-infor">
                                                                                    <img src="../@dish.Image" />
                                                                                    <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                </td>
                                                                            }
                                                                            else
                                                                            {
                                                                                <td class="display-infor">
                                                                                    <img src="~/images/chao-hanh.jpg" />
                                                                                    <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                </td>
                                                                            }
                                                                        }
                                                                        var orderState = (from os in _db.OrderStates
                                                                                          join ot in _db.OrderTracks on os.IDOrderStatse equals ot.IDOrderStatse
                                                                                          where ot.IDBill == s.IDBill
                                                                                          select os.StateName).SingleOrDefault();
                                                                        <td class="text-center">@s.Total</td>
                                                                        <td class="text-center">@orderState</td>
                                                                        <td class="text-center">Giao tiêu chuẩn</td>
                                                                        <td class="text-center">
                                                                            <a href="/OrderManagement/InformationProducts" class="detail">Xem chi tiết</a>
                                                                            <button class="button-sale">Mua lần nữa</button>
                                                                            <a href="/OrderManagement/StatePreparing?IDBill=@s.IDBill" class="detail">Chuyển state</a>
                                                                        </td>
                                                                    }
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                        @{
                                                            var usertemp = (from u in _db.Users
                                                                            where u.IDUser == s.IDUser
                                                                            select u).SingleOrDefault();
                                                            <div class="table-top">
                                                                <div class="table-top-user"><i class="fa fa-user-circle-o">@usertemp.Username</i></div>
                                                                <div class="table-top-products">@s.IDBill</div>
                                                            </div>

                                                        }

                                                    </div>
                                                }


                                            }
                                        }
                                        //Seller
                                        else if (role.IDRole == "R02")
                                        {
                                            foreach (var s in Model)
                                            {
                                                OrderTrack orderTrack = _db.OrderTracks.SingleOrDefault(n => n.IDBill == s.IDBill && n.IDOrderStatse == "OS-02");
                                                if (orderTrack != null)
                                                {
                                                    var store = (from sto in _db.Stores
                                                                 where sto.IDStore == s.IDStore && user.IDUser == sto.IDUser
                                                                 select sto).SingleOrDefault();
                                                    if (store != null)
                                                    {
                                                        <div class="tabcontent-all-bottom-left">
                                                            <table>
                                                                <thead>
                                                                    <tr>
                                                                        <th style="width: 30% "><i class="fa fa-info-circle"></i>Thông tin sản phẩm</th>
                                                                        <th style="width: 10% ">Tổng đơn hàng</th>
                                                                        <th style="width: 22.5% ">Trạng thái</th>
                                                                        <th style="width: 22.5% ">Vận chuyển</th>
                                                                        <th style="width: 15% ">Thao tác</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr>
                                                                        @{
                                                                            var BillDetails = (from bd in _db.BillDetails
                                                                                               where bd.IDBill == s.IDBill
                                                                                               select bd).ToList();
                                                                            foreach (var bd in BillDetails)
                                                                            {
                                                                                var dish = _db.Menus.SingleOrDefault(n => n.DishName == bd.DishName);
                                                                                if (dish != null)
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="../@dish.Image" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="~/images/chao-hanh.jpg" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                            }
                                                                            var orderState = (from os in _db.OrderStates
                                                                                              join ot in _db.OrderTracks on os.IDOrderStatse equals ot.IDOrderStatse
                                                                                              where ot.IDBill == s.IDBill
                                                                                              select os.StateName).SingleOrDefault();
                                                                            <td class="text-center">@s.Total</td>
                                                                            <td class="text-center">@orderState</td>
                                                                            <td class="text-center">Giao tiêu chuẩn</td>
                                                                            <td class="text-center">
                                                                                <a href="/OrderManagement/InformationProducts" class="detail">Xem chi tiết</a>
                                                                                <button class="button-sale">Mua lần nữa</button>
                                                                                <a href="/OrderManagement/StatePreparing?IDBill=@s.IDBill" class="detail">Chuyển state</a>
                                                                            </td>
                                                                        }
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            @{
                                                                var usertemp = (from u in _db.Users
                                                                                where u.IDUser == s.IDUser
                                                                                select u).SingleOrDefault();
                                                                <div class="table-top">
                                                                    <div class="table-top-user"><i class="fa fa-user-circle-o">@usertemp.Username</i></div>
                                                                    <div class="table-top-products">@s.IDBill</div>
                                                                </div>
                                                            }
                                                        </div>
                                                    }
                                                }
                                            }
                                        }
                                        //Customers
                                        else if (role.IDRole == "R03")
                                        {
                                            foreach (var s in Model)
                                            {
                                                OrderTrack orderTrack = _db.OrderTracks.SingleOrDefault(n => n.IDBill == s.IDBill && n.IDOrderStatse == "OS-02");
                                                if (orderTrack != null)
                                                {
                                                    if (s.IDUser == user.IDUser)
                                                    {
                                                        <div class="tabcontent-all-bottom-left">
                                                            <table>
                                                                <thead>
                                                                    <tr>
                                                                        <th style="width: 30% "><i class="fa fa-info-circle"></i>Thông tin sản phẩm</th>
                                                                        <th style="width: 10% ">Tổng đơn hàng</th>
                                                                        <th style="width: 30% ">Trạng thái</th>
                                                                        <th style="width: 15% ">Vận chuyển</th>
                                                                        <th style="width: 15% ">Thao tác</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr>
                                                                        @{
                                                                            var billDetails = (from bd in _db.BillDetails
                                                                                               where bd.IDBill == s.IDBill
                                                                                               select bd).ToList();
                                                                            foreach (var bd in billDetails)
                                                                            {
                                                                                var dish = _db.Menus.SingleOrDefault(n => n.DishName == bd.DishName);
                                                                                if (dish != null)
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="../@dish.Image" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="~/images/chao-hanh.jpg" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                            }
                                                                            var orderState = (from os in _db.OrderStates
                                                                                              join ot in _db.OrderTracks on os.IDOrderStatse equals ot.IDOrderStatse
                                                                                              where ot.IDBill == s.IDBill
                                                                                              select os.StateName).SingleOrDefault();
                                                                            <td class="text-center">@s.Total</td>
                                                                            <td class="text-center">@orderState</td>
                                                                            <td class="text-center">Giao tiêu chuẩn</td>
                                                                            <td class="text-center">
                                                                                <a href="/OrderManagement/InformationProducts" class="detail">Xem chi tiết</a>
                                                                                <button class="button-sale">Mua lần nữa</button>
                                                                                <button class="button-sale">Hủy</button>
                                                                            </td>
                                                                        }
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            <div class="table-top">
                                                                <div class="table-top-user"><i class="fa fa-user-circle-o">@user.Username</i></div>
                                                                <div class="table-top-products">@s.IDBill</div>
                                                            </div>
                                                        </div>
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            </div>
                        </div>
                    </div>
                    <!--Tab Giao Hàng-->
                    <div class="tabcontent" id="Delivering">
                        <div class="tabcontent-top-search">
                            <div class="tabcontent-container">
                                <div class="search-border">
                                    <i class="fa fa-search"></i>
                                    @{

                                        if (input != null)
                                        {
                                            <input class="search" type="text" placeholder="Tìm theo tên sản phẩm, ID đơn hàng" value="@input" />
                                        }
                                        else
                                        {
                                            <input class="search" type="text" placeholder="Tìm theo tên sản phẩm, ID đơn hàng" />
                                        }
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="tabcontent-all-bottom">
                            <div class="tabcontent-all-bottom-products">
                                @{
                                    if (user != null)
                                    {
                                        var role = _db.User_Roles.SingleOrDefault(n => n.IDUser == user.IDUser);
                                        //Administrator
                                        if (role.IDRole == "R01")
                                        {
                                            foreach (var s in Model)
                                            {
                                                OrderTrack orderTrack = _db.OrderTracks.SingleOrDefault(n => n.IDBill == s.IDBill && n.IDOrderStatse == "OS-03");
                                                if (orderTrack != null)
                                                {
                                                    <div class="tabcontent-all-bottom-left">
                                                        <table>
                                                            <thead>
                                                                <tr>
                                                                    <th style="width: 30% "><i class="fa fa-info-circle"></i>Thông tin sản phẩm</th>
                                                                    <th style="width: 10% ">Tổng đơn hàng</th>
                                                                    <th style="width: 22.5% ">Trạng thái</th>
                                                                    <th style="width: 22.5% ">Vận chuyển</th>
                                                                    <th style="width: 15% ">Thao tác</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr>
                                                                    @{
                                                                        var BillDetails = (from bd in _db.BillDetails
                                                                                           where bd.IDBill == s.IDBill
                                                                                           select bd).ToList();
                                                                        foreach (var bd in BillDetails)
                                                                        {
                                                                            var dish = _db.Menus.SingleOrDefault(n => n.DishName == bd.DishName);
                                                                            if (dish != null)
                                                                            {
                                                                                <td class="display-infor">
                                                                                    <img src="../@dish.Image" />
                                                                                    <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                </td>
                                                                            }
                                                                            else
                                                                            {
                                                                                <td class="display-infor">
                                                                                    <img src="~/images/chao-hanh.jpg" />
                                                                                    <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                </td>
                                                                            }
                                                                        }
                                                                        var orderState = (from os in _db.OrderStates
                                                                                          join ot in _db.OrderTracks on os.IDOrderStatse equals ot.IDOrderStatse
                                                                                          where ot.IDBill == s.IDBill
                                                                                          select os.StateName).SingleOrDefault();
                                                                        <td class="text-center">@s.Total</td>
                                                                        <td class="text-center">@orderState</td>
                                                                        <td class="text-center">Giao tiêu chuẩn</td>
                                                                        <td class="text-center">
                                                                            <a href="/OrderManagement/InformationProducts" class="detail">Xem chi tiết</a>
                                                                            <button class="button-sale">Mua lần nữa</button>
                                                                            <a href="/OrderManagement/StateDelivering?IDBill=@s.IDBill" class="detail">Chuyển state</a>
                                                                        </td>
                                                                    }
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                        @{
                                                            var usertemp = (from u in _db.Users
                                                                            where u.IDUser == s.IDUser
                                                                            select u).SingleOrDefault();
                                                            <div class="table-top">
                                                                <div class="table-top-user"><i class="fa fa-user-circle-o">@usertemp.Username</i></div>
                                                                <div class="table-top-products">@s.IDBill</div>
                                                            </div>
                                                        }
                                                    </div>
                                                }
                                            }
                                        }
                                        //Seller
                                        else if (role.IDRole == "R02")
                                        {
                                            foreach (var s in Model)
                                            {
                                                OrderTrack orderTrack = _db.OrderTracks.SingleOrDefault(n => n.IDBill == s.IDBill && n.IDOrderStatse == "OS-03");
                                                if (orderTrack != null)
                                                {
                                                    var bill = (from b in _db.Bills
                                                                join sto in _db.Stores on b.IDStore equals sto.IDStore
                                                                where sto.IDUser == user.IDUser && b.IDBill == s.IDBill
                                                                select b).SingleOrDefault();
                                                    if (bill != null)
                                                    {
                                                        <div class="tabcontent-all-bottom-left">
                                                            <table>
                                                                <thead>
                                                                    <tr>
                                                                        <th style="width: 30% "><i class="fa fa-info-circle"></i>Thông tin sản phẩm</th>
                                                                        <th style="width: 10% ">Tổng đơn hàng</th>
                                                                        <th style="width: 22.5% ">Trạng thái</th>
                                                                        <th style="width: 22.5% ">Vận chuyển</th>
                                                                        <th style="width: 15% ">Thao tác</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr>
                                                                        @{
                                                                            var BillDetails = (from bd in _db.BillDetails
                                                                                               where bd.IDBill == s.IDBill
                                                                                               select bd).ToList();
                                                                            foreach (var bd in BillDetails)
                                                                            {
                                                                                var dish = _db.Menus.SingleOrDefault(n => n.DishName == bd.DishName);
                                                                                if (dish != null)
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="../@dish.Image" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="~/images/chao-hanh.jpg" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                            }
                                                                            var orderState = (from os in _db.OrderStates
                                                                                              join ot in _db.OrderTracks on os.IDOrderStatse equals ot.IDOrderStatse
                                                                                              where ot.IDBill == s.IDBill
                                                                                              select os.StateName).SingleOrDefault();
                                                                            <td class="text-center">@s.Total</td>
                                                                            <td class="text-center">@orderState</td>
                                                                            <td class="text-center">Giao tiêu chuẩn</td>
                                                                            <td class="text-center">
                                                                                <a href="/OrderManagement/InformationProducts" class="detail">Xem chi tiết</a>
                                                                                <button class="button-sale">Mua lần nữa</button>
                                                                                <a href="/OrderManagement/StateDelivering?IDBill=@s.IDBill" class="detail">Chuyển state</a>
                                                                            </td>
                                                                        }
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            @{
                                                                var usertemp = (from u in _db.Users
                                                                                where u.IDUser == s.IDUser
                                                                                select u).SingleOrDefault();
                                                                <div class="table-top">
                                                                    <div class="table-top-user"><i class="fa fa-user-circle-o">@usertemp.Username</i></div>
                                                                    <div class="table-top-products">@s.IDBill</div>
                                                                </div>

                                                            }
                                                        </div>
                                                    }
                                                }
                                            }
                                        }
                                        //Customers
                                        else if (role.IDRole == "R03")
                                        {
                                            foreach (var s in Model)
                                            {
                                                OrderTrack orderTrack = _db.OrderTracks.SingleOrDefault(n => n.IDBill == s.IDBill && n.IDOrderStatse == "OS-03");
                                                if (orderTrack != null)
                                                {
                                                    if (s.IDUser == user.IDUser)
                                                    {
                                                        <div class="tabcontent-all-bottom-left">
                                                            <table>
                                                                <thead>
                                                                    <tr>
                                                                        <th style="width: 30% "><i class="fa fa-info-circle"></i>Thông tin sản phẩm</th>
                                                                        <th style="width: 10% ">Tổng đơn hàng</th>
                                                                        <th style="width: 30% ">Trạng thái</th>
                                                                        <th style="width: 15% ">Vận chuyển</th>
                                                                        <th style="width: 15% ">Thao tác</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr>
                                                                        @{
                                                                            var billDetails = (from bd in _db.BillDetails
                                                                                               where bd.IDBill == s.IDBill
                                                                                               select bd).ToList();
                                                                            foreach (var bd in billDetails)
                                                                            {
                                                                                var dish = _db.Menus.SingleOrDefault(n => n.DishName == bd.DishName);
                                                                                if (dish != null)
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="../@dish.Image" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="~/images/chao-hanh.jpg" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                            }
                                                                            var orderState = (from os in _db.OrderStates
                                                                                              join ot in _db.OrderTracks on os.IDOrderStatse equals ot.IDOrderStatse
                                                                                              where ot.IDBill == s.IDBill
                                                                                              select os.StateName).SingleOrDefault();
                                                                            <td class="text-center">@s.Total</td>
                                                                            <td class="text-center">@orderState</td>
                                                                            <td class="text-center">Giao tiêu chuẩn</td>
                                                                            <td class="text-center">
                                                                                <a href="/OrderManagement/InformationProducts" class="detail">Xem chi tiết</a>
                                                                                <button class="button-sale">Mua lần nữa</button>
                                                                                <button class="button-sale">Hủy</button>
                                                                            </td>
                                                                        }
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            <div class="table-top">
                                                                <div class="table-top-user"><i class="fa fa-user-circle-o">@user.Username</i></div>
                                                                <div class="table-top-products">@s.IDBill</div>
                                                            </div>
                                                        </div>
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            </div>
                        </div>
                    </div>
                    <!--Tab Thanh Toán-->
                    <div class="tabcontent" id="Paid">
                        <div class="tabcontent-top-search">
                            <div class="tabcontent-container">
                                <div class="search-border">
                                    <i class="fa fa-search"></i>
                                    @{

                                        if (input != null)
                                        {
                                            <input class="search" type="text" placeholder="Tìm theo tên sản phẩm, ID đơn hàng" value="@input" />
                                        }
                                        else
                                        {
                                            <input class="search" type="text" placeholder="Tìm theo tên sản phẩm, ID đơn hàng" />
                                        }
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="tabcontent-all-bottom">
                            <div class="tabcontent-all-bottom-products">
                                @{
                                    if (user != null)
                                    {
                                        var role = _db.User_Roles.SingleOrDefault(n => n.IDUser == user.IDUser);
                                        //Administrator
                                        if (role.IDRole == "R01")
                                        {
                                            foreach (var s in Model)
                                            {
                                                OrderTrack orderTrack = _db.OrderTracks.SingleOrDefault(n => n.IDBill == s.IDBill && n.IDOrderStatse == "OS-04");
                                                if (orderTrack != null)
                                                {
                                                    <div class="tabcontent-all-bottom-left">
                                                        <table>
                                                            <thead>
                                                                <tr>
                                                                    <th style="width: 30% "><i class="fa fa-info-circle"></i>Thông tin sản phẩm</th>
                                                                    <th style="width: 10% ">Tổng đơn hàng</th>
                                                                    <th style="width: 22.5% ">Trạng thái</th>
                                                                    <th style="width: 22.5% ">Vận chuyển</th>
                                                                    <th style="width: 15% ">Thao tác</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr>
                                                                    @{
                                                                        var BillDetails = (from bd in _db.BillDetails
                                                                                           where bd.IDBill == s.IDBill
                                                                                           select bd).ToList();
                                                                        foreach (var bd in BillDetails)
                                                                        {
                                                                            var dish = _db.Menus.SingleOrDefault(n => n.DishName == bd.DishName);
                                                                            if (dish != null)
                                                                            {
                                                                                <td class="display-infor">
                                                                                    <img src="../@dish.Image" />
                                                                                    <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                </td>
                                                                            }
                                                                            else
                                                                            {
                                                                                <td class="display-infor">
                                                                                    <img src="~/images/chao-hanh.jpg" />
                                                                                    <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                </td>
                                                                            }
                                                                        }
                                                                        var orderState = (from os in _db.OrderStates
                                                                                          join ot in _db.OrderTracks on os.IDOrderStatse equals ot.IDOrderStatse
                                                                                          where ot.IDBill == s.IDBill
                                                                                          select os.StateName).SingleOrDefault();
                                                                        <td class="text-center">@s.Total</td>
                                                                        <td class="text-center">@orderState</td>
                                                                        <td class="text-center">Giao tiêu chuẩn</td>
                                                                        <td class="text-center">
                                                                            <a href="/OrderManagement/InformationProducts" class="detail">Xem chi tiết</a>
                                                                            <button class="button-sale">Mua lần nữa</button>
                                                                            <a href="/OrderManagement/StatePaid?IDBill=@s.IDBill" class="detail">Chuyển state</a>
                                                                        </td>
                                                                    }
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                        @{
                                                            var usertemp = (from u in _db.Users
                                                                            where u.IDUser == s.IDUser
                                                                            select u).SingleOrDefault();
                                                            <div class="table-top">
                                                                <div class="table-top-user"><i class="fa fa-user-circle-o">@usertemp.Username</i></div>
                                                                <div class="table-top-products">@s.IDBill</div>
                                                            </div>
                                                        }
                                                    </div>
                                                }
                                            }
                                        }
                                        //Seller
                                        else if (role.IDRole == "R02")
                                        {
                                            foreach (var s in Model)
                                            {
                                                OrderTrack orderTrack = _db.OrderTracks.SingleOrDefault(n => n.IDBill == s.IDBill && n.IDOrderStatse == "OS-04");
                                                if (orderTrack != null)
                                                {
                                                    var bill = (from b in _db.Bills
                                                                join sto in _db.Stores on b.IDStore equals sto.IDStore
                                                                where sto.IDUser == user.IDUser && b.IDBill == s.IDBill
                                                                select b).SingleOrDefault();
                                                    if (bill != null)
                                                    {
                                                        <div class="tabcontent-all-bottom-left">
                                                            <table>
                                                                <thead>
                                                                    <tr>
                                                                        <th style="width: 30% "><i class="fa fa-info-circle"></i>Thông tin sản phẩm</th>
                                                                        <th style="width: 10% ">Tổng đơn hàng</th>
                                                                        <th style="width: 22.5% ">Trạng thái</th>
                                                                        <th style="width: 22.5% ">Vận chuyển</th>
                                                                        <th style="width: 15% ">Thao tác</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr>
                                                                        @{
                                                                            var BillDetails = (from bd in _db.BillDetails
                                                                                               where bd.IDBill == s.IDBill
                                                                                               select bd).ToList();
                                                                            foreach (var bd in BillDetails)
                                                                            {
                                                                                var dish = _db.Menus.SingleOrDefault(n => n.DishName == bd.DishName);
                                                                                if (dish != null)
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="../@dish.Image" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="~/images/chao-hanh.jpg" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                            }
                                                                            var orderState = (from os in _db.OrderStates
                                                                                              join ot in _db.OrderTracks on os.IDOrderStatse equals ot.IDOrderStatse
                                                                                              where ot.IDBill == s.IDBill
                                                                                              select os.StateName).SingleOrDefault();
                                                                            <td class="text-center">@s.Total</td>
                                                                            <td class="text-center">@orderState</td>
                                                                            <td class="text-center">Giao tiêu chuẩn</td>
                                                                            <td class="text-center">
                                                                                <a href="/OrderManagement/InformationProducts" class="detail">Xem chi tiết</a>
                                                                                <button class="button-sale">Mua lần nữa</button>
                                                                                <a href="/OrderManagement/StatePaid?IDBill=@s.IDBill" class="detail">Chuyển state</a>
                                                                            </td>
                                                                        }
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            @{
                                                                var usertemp = (from u in _db.Users
                                                                                where u.IDUser == s.IDUser
                                                                                select u).SingleOrDefault();
                                                                <div class="table-top">
                                                                    <div class="table-top-user"><i class="fa fa-user-circle-o">@usertemp.Username</i></div>
                                                                    <div class="table-top-products">@s.IDBill</div>
                                                                </div>
                                                            }
                                                        </div>
                                                    }
                                                }
                                            }
                                        }
                                        //Customers
                                        else if (role.IDRole == "R03")
                                        {
                                            foreach (var s in Model)
                                            {
                                                OrderTrack orderTrack = _db.OrderTracks.SingleOrDefault(n => n.IDBill == s.IDBill && n.IDOrderStatse == "OS-04");
                                                if (orderTrack != null)
                                                {
                                                    if (s.IDUser == user.IDUser)
                                                    {
                                                        <div class="tabcontent-all-bottom-left">
                                                            <table>
                                                                <thead>
                                                                    <tr>
                                                                        <th style="width: 30% "><i class="fa fa-info-circle"></i>Thông tin sản phẩm</th>
                                                                        <th style="width: 10% ">Tổng đơn hàng</th>
                                                                        <th style="width: 30% ">Trạng thái</th>
                                                                        <th style="width: 15% ">Vận chuyển</th>
                                                                        <th style="width: 15% ">Thao tác</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr>
                                                                        @{
                                                                            var billDetails = (from bd in _db.BillDetails
                                                                                               where bd.IDBill == s.IDBill
                                                                                               select bd).ToList();
                                                                            foreach (var bd in billDetails)
                                                                            {
                                                                                var dish = _db.Menus.SingleOrDefault(n => n.DishName == bd.DishName);
                                                                                if (dish != null)
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="../@dish.Image" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="~/images/chao-hanh.jpg" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                            }
                                                                            var orderState = (from os in _db.OrderStates
                                                                                              join ot in _db.OrderTracks on os.IDOrderStatse equals ot.IDOrderStatse
                                                                                              where ot.IDBill == s.IDBill
                                                                                              select os.StateName).SingleOrDefault();
                                                                            <td class="text-center">@s.Total</td>
                                                                            <td class="text-center">@orderState</td>
                                                                            <td class="text-center">Giao tiêu chuẩn</td>
                                                                            <td class="text-center">
                                                                                <a href="/OrderManagement/InformationProducts" class="detail">Xem chi tiết</a>
                                                                                <button class="button-sale">Mua lần nữa</button>
                                                                                <button class="button-sale">Hủy</button>
                                                                            </td>
                                                                        }
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            <div class="table-top">
                                                                <div class="table-top-user"><i class="fa fa-user-circle-o">@user.Username</i></div>
                                                                <div class="table-top-products">@s.IDBill</div>
                                                            </div>
                                                        </div>
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            </div>
                        </div>
                    </div>
                    <!--Tab Hoàn thành-->
                    <div class="tabcontent" id="Completion">
                        <div class="tabcontent-top-search">
                            <div class="tabcontent-container">
                                <div class="search-border">
                                    <i class="fa fa-search"></i>
                                    @{

                                        if (input != null)
                                        {
                                            <input class="search" type="text" placeholder="Tìm theo tên sản phẩm, ID đơn hàng" value="@input" />
                                        }
                                        else
                                        {
                                            <input class="search" type="text" placeholder="Tìm theo tên sản phẩm, ID đơn hàng" />
                                        }
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="tabcontent-all-bottom">
                            <div class="tabcontent-all-bottom-products">
                                @{
                                    if (user != null)
                                    {
                                        var role = _db.User_Roles.SingleOrDefault(n => n.IDUser == user.IDUser);
                                        //Administrator
                                        if (role.IDRole == "R01")
                                        {
                                            foreach (var s in Model)
                                            {
                                                OrderTrack orderTrack = _db.OrderTracks.SingleOrDefault(n => n.IDBill == s.IDBill && n.IDOrderStatse == "OS-05");
                                                if (orderTrack != null)
                                                {
                                                    <div class="tabcontent-all-bottom-left">
                                                        <table>
                                                            <thead>
                                                                <tr>
                                                                    <th style="width: 30% "><i class="fa fa-info-circle"></i>Thông tin sản phẩm</th>
                                                                    <th style="width: 10% ">Tổng đơn hàng</th>
                                                                    <th style="width: 22.5% ">Trạng thái</th>
                                                                    <th style="width: 22.5% ">Vận chuyển</th>
                                                                    <th style="width: 15% ">Thao tác</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr>
                                                                    @{
                                                                        var BillDetails = (from bd in _db.BillDetails
                                                                                           where bd.IDBill == s.IDBill
                                                                                           select bd).ToList();
                                                                        foreach (var bd in BillDetails)
                                                                        {
                                                                            var dish = _db.Menus.SingleOrDefault(n => n.DishName == bd.DishName);
                                                                            if (dish != null)
                                                                            {
                                                                                <td class="display-infor">
                                                                                    <img src="../@dish.Image" />
                                                                                    <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                </td>
                                                                            }
                                                                            else
                                                                            {
                                                                                <td class="display-infor">
                                                                                    <img src="~/images/chao-hanh.jpg" />
                                                                                    <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                </td>
                                                                            }
                                                                        }
                                                                        var orderState = (from os in _db.OrderStates
                                                                                          join ot in _db.OrderTracks on os.IDOrderStatse equals ot.IDOrderStatse
                                                                                          where ot.IDBill == s.IDBill
                                                                                          select os.StateName).SingleOrDefault();
                                                                        <td class="text-center">@s.Total</td>
                                                                        <td class="text-center">@orderState</td>
                                                                        <td class="text-center">Giao tiêu chuẩn</td>
                                                                        <td class="text-center">
                                                                            <a href="/OrderManagement/InformationProducts" class="detail">Xem chi tiết</a>
                                                                            <button class="button-sale">Mua lần nữa</button>
                                                                        </td>
                                                                    }
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                        @{
                                                            var usertemp = (from u in _db.Users
                                                                            where u.IDUser == s.IDUser
                                                                            select u).SingleOrDefault();
                                                            <div class="table-top">
                                                                <div class="table-top-user"><i class="fa fa-user-circle-o">@usertemp.Username</i></div>
                                                                <div class="table-top-products">@s.IDBill</div>
                                                            </div>

                                                        }

                                                    </div>
                                                }


                                            }
                                        }
                                        //Seller
                                        else if (role.IDRole == "R02")
                                        {
                                            foreach (var s in Model)
                                            {
                                                OrderTrack orderTrack = _db.OrderTracks.SingleOrDefault(n => n.IDBill == s.IDBill && n.IDOrderStatse == "OS-05");
                                                if (orderTrack != null)
                                                {
                                                    var bill = (from b in _db.Bills
                                                                join sto in _db.Stores on b.IDStore equals sto.IDStore
                                                                where sto.IDUser == user.IDUser && b.IDBill == s.IDBill
                                                                select b).SingleOrDefault();
                                                    if (bill != null)
                                                    {
                                                        <div class="tabcontent-all-bottom-left">
                                                            <table>
                                                                <thead>
                                                                    <tr>
                                                                        <th style="width: 30% "><i class="fa fa-info-circle"></i>Thông tin sản phẩm</th>
                                                                        <th style="width: 10% ">Tổng đơn hàng</th>
                                                                        <th style="width: 22.5% ">Trạng thái</th>
                                                                        <th style="width: 22.5% ">Vận chuyển</th>
                                                                        <th style="width: 15% ">Thao tác</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr>
                                                                        @{
                                                                            var BillDetails = (from bd in _db.BillDetails
                                                                                               where bd.IDBill == s.IDBill
                                                                                               select bd).ToList();
                                                                            foreach (var bd in BillDetails)
                                                                            {
                                                                                var dish = _db.Menus.SingleOrDefault(n => n.DishName == bd.DishName);
                                                                                if (dish != null)
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="../@dish.Image" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="~/images/chao-hanh.jpg" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                            }
                                                                            var orderState = (from os in _db.OrderStates
                                                                                              join ot in _db.OrderTracks on os.IDOrderStatse equals ot.IDOrderStatse
                                                                                              where ot.IDBill == s.IDBill
                                                                                              select os.StateName).SingleOrDefault();
                                                                            <td class="text-center">@s.Total</td>
                                                                            <td class="text-center">@orderState</td>
                                                                            <td class="text-center">Giao tiêu chuẩn</td>
                                                                            <td class="text-center">
                                                                                <a href="/OrderManagement/InformationProducts" class="detail">Xem chi tiết</a>
                                                                                <button class="button-sale">Mua lần nữa</button>
                                                                            </td>
                                                                        }
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            @{
                                                                var usertemp = (from u in _db.Users
                                                                                where u.IDUser == s.IDUser
                                                                                select u).SingleOrDefault();
                                                                <div class="table-top">
                                                                    <div class="table-top-user"><i class="fa fa-user-circle-o">@usertemp.Username</i></div>
                                                                    <div class="table-top-products">@s.IDBill</div>
                                                                </div>
                                                            }
                                                        </div>
                                                    }
                                                }
                                            }
                                        }
                                        //Customers
                                        else if (role.IDRole == "R03")
                                        {
                                            foreach (var s in Model)
                                            {
                                                OrderTrack orderTrack = _db.OrderTracks.SingleOrDefault(n => n.IDBill == s.IDBill && n.IDOrderStatse == "OS-05");
                                                if (orderTrack != null)
                                                {
                                                    if (s.IDUser == user.IDUser)
                                                    {
                                                        <div class="tabcontent-all-bottom-left">
                                                            <table>
                                                                <thead>
                                                                    <tr>
                                                                        <th style="width: 30% "><i class="fa fa-info-circle"></i>Thông tin sản phẩm</th>
                                                                        <th style="width: 10% ">Tổng đơn hàng</th>
                                                                        <th style="width: 30% ">Trạng thái</th>
                                                                        <th style="width: 15% ">Vận chuyển</th>
                                                                        <th style="width: 15% ">Thao tác</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr>
                                                                        @{
                                                                            var billDetails = (from bd in _db.BillDetails
                                                                                               where bd.IDBill == s.IDBill
                                                                                               select bd).ToList();
                                                                            foreach (var bd in billDetails)
                                                                            {
                                                                                var dish = _db.Menus.SingleOrDefault(n => n.DishName == bd.DishName);
                                                                                if (dish != null)
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="../@dish.Image" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="~/images/chao-hanh.jpg" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                            }
                                                                            var orderState = (from os in _db.OrderStates
                                                                                              join ot in _db.OrderTracks on os.IDOrderStatse equals ot.IDOrderStatse
                                                                                              where ot.IDBill == s.IDBill
                                                                                              select os.StateName).SingleOrDefault();
                                                                            <td class="text-center">@s.Total</td>
                                                                            <td class="text-center">@orderState</td>
                                                                            <td class="text-center">Giao tiêu chuẩn</td>
                                                                            <td class="text-center">
                                                                                <a href="/OrderManagement/InformationProducts" class="detail">Xem chi tiết</a>
                                                                                <button class="button-sale">Mua lần nữa</button>
                                                                                <button class="button-sale">Hủy</button>
                                                                            </td>
                                                                        }
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            <div class="table-top">
                                                                <div class="table-top-user"><i class="fa fa-user-circle-o">@user.Username</i></div>
                                                                <div class="table-top-products">@s.IDBill</div>
                                                            </div>
                                                        </div>
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            </div>
                        </div>
                    </div>
                    <!--Tab Đã hủy-->
                    <div class="tabcontent" id="Cancelleation">
                        <div class="tabcontent-top-search">
                            <div class="tabcontent-container">
                                <div class="search-border">
                                    <i class="fa fa-search"></i>
                                    @{

                                        if (input != null)
                                        {
                                            <input class="search" type="text" placeholder="Tìm theo tên sản phẩm, ID đơn hàng" value="@input" />
                                        }
                                        else
                                        {
                                            <input class="search" type="text" placeholder="Tìm theo tên sản phẩm, ID đơn hàng" />
                                        }
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="tabcontent-all-bottom">
                            <div class="tabcontent-all-bottom-products">
                                @{
                                    if (user != null)
                                    {
                                        var role = _db.User_Roles.SingleOrDefault(n => n.IDUser == user.IDUser);
                                        //Administrator
                                        if (role.IDRole == "R01")
                                        {
                                            foreach (var s in Model)
                                            {
                                                OrderTrack orderTrack = _db.OrderTracks.SingleOrDefault(n => n.IDBill == s.IDBill && n.IDOrderStatse == "OS-07");
                                                if (orderTrack != null)
                                                {
                                                    <div class="tabcontent-all-bottom-left">
                                                        <table>
                                                            <thead>
                                                                <tr>
                                                                    <th style="width: 30% "><i class="fa fa-info-circle"></i>Thông tin sản phẩm</th>
                                                                    <th style="width: 10% ">Tổng đơn hàng</th>
                                                                    <th style="width: 22.5% ">Trạng thái</th>
                                                                    <th style="width: 22.5% ">Vận chuyển</th>
                                                                    <th style="width: 15% ">Thao tác</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr>
                                                                    @{
                                                                        var BillDetails = (from bd in _db.BillDetails
                                                                                           where bd.IDBill == s.IDBill
                                                                                           select bd).ToList();
                                                                        foreach (var bd in BillDetails)
                                                                        {
                                                                            var dish = _db.Menus.SingleOrDefault(n => n.DishName == bd.DishName);
                                                                            if (dish != null)
                                                                            {
                                                                                <td class="display-infor">
                                                                                    <img src="../@dish.Image" />
                                                                                    <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                </td>
                                                                            }
                                                                            else
                                                                            {
                                                                                <td class="display-infor">
                                                                                    <img src="~/images/chao-hanh.jpg" />
                                                                                    <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                </td>
                                                                            }
                                                                        }
                                                                        var orderState = (from os in _db.OrderStates
                                                                                          join ot in _db.OrderTracks on os.IDOrderStatse equals ot.IDOrderStatse
                                                                                          where ot.IDBill == s.IDBill
                                                                                          select os.StateName).SingleOrDefault();
                                                                        <td class="text-center">@s.Total</td>
                                                                        <td class="text-center">@orderState</td>
                                                                        <td class="text-center">Giao tiêu chuẩn</td>
                                                                        <td class="text-center">
                                                                            <a href="/OrderManagement/InformationProducts" class="detail">Xem chi tiết</a>
                                                                            <button class="button-sale">Mua lần nữa</button>
                                                                            <a href="#" class="detail">Chuyển state</a>
                                                                        </td>
                                                                    }
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                        @{
                                                            var usertemp = (from u in _db.Users
                                                                            where u.IDUser == s.IDUser
                                                                            select u).SingleOrDefault();
                                                            <div class="table-top">
                                                                <div class="table-top-user"><i class="fa fa-user-circle-o">@usertemp.Username</i></div>
                                                                <div class="table-top-products">@s.IDBill</div>
                                                            </div>

                                                        }

                                                    </div>
                                                }


                                            }
                                        }
                                        //Sellers
                                        else if (role.IDRole == "R02")
                                        {
                                            foreach (var s in Model)
                                            {
                                                OrderTrack orderTrack = _db.OrderTracks.SingleOrDefault(n => n.IDBill == s.IDBill && n.IDOrderStatse == "OS-07");
                                                if (orderTrack != null)
                                                {
                                                    var bill = (from b in _db.Bills
                                                                join sto in _db.Stores on b.IDStore equals sto.IDStore
                                                                where sto.IDUser == user.IDUser && b.IDBill == s.IDBill
                                                                select b).SingleOrDefault();
                                                    if (bill != null)
                                                    {
                                                        <div class="tabcontent-all-bottom-left">
                                                            <table>
                                                                <thead>
                                                                    <tr>
                                                                        <th style="width: 30% "><i class="fa fa-info-circle"></i>Thông tin sản phẩm</th>
                                                                        <th style="width: 10% ">Tổng đơn hàng</th>
                                                                        <th style="width: 22.5% ">Trạng thái</th>
                                                                        <th style="width: 22.5% ">Vận chuyển</th>
                                                                        <th style="width: 15% ">Thao tác</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr>
                                                                        @{
                                                                            var BillDetails = (from bd in _db.BillDetails
                                                                                               where bd.IDBill == s.IDBill
                                                                                               select bd).ToList();
                                                                            foreach (var bd in BillDetails)
                                                                            {
                                                                                var dish = _db.Menus.SingleOrDefault(n => n.DishName == bd.DishName);
                                                                                if (dish != null)
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="../@dish.Image" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="~/images/chao-hanh.jpg" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                            }
                                                                            var orderState = (from os in _db.OrderStates
                                                                                              join ot in _db.OrderTracks on os.IDOrderStatse equals ot.IDOrderStatse
                                                                                              where ot.IDBill == s.IDBill
                                                                                              select os.StateName).SingleOrDefault();
                                                                            <td class="text-center">@s.Total</td>
                                                                            <td class="text-center">@orderState</td>
                                                                            <td class="text-center">Giao tiêu chuẩn</td>
                                                                            <td class="text-center">
                                                                                <a href="/OrderManagement/InformationProducts" class="detail">Xem chi tiết</a>
                                                                                <button class="button-sale">Mua lần nữa</button>
                                                                                <a href="#" class="detail">Chuyển state</a>
                                                                            </td>
                                                                        }
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            @{
                                                                var usertemp = (from u in _db.Users
                                                                                where u.IDUser == s.IDUser
                                                                                select u).SingleOrDefault();
                                                                <div class="table-top">
                                                                    <div class="table-top-user"><i class="fa fa-user-circle-o">@usertemp.Username</i></div>
                                                                    <div class="table-top-products">@s.IDBill</div>
                                                                </div>

                                                            }

                                                        </div>
                                                    }
                                                }

                                            }
                                        }
                                        //Customers
                                        else if (role.IDRole == "R03")
                                        {
                                            foreach (var s in Model)
                                            {
                                                OrderTrack orderTrack = _db.OrderTracks.SingleOrDefault(n => n.IDBill == s.IDBill && n.IDOrderStatse == "OS-07");
                                                if (orderTrack != null)
                                                {
                                                    if (s.IDUser == user.IDUser)
                                                    {
                                                        <div class="tabcontent-all-bottom-left">
                                                            <table>
                                                                <thead>
                                                                    <tr>
                                                                        <th style="width: 30% "><i class="fa fa-info-circle"></i>Thông tin sản phẩm</th>
                                                                        <th style="width: 10% ">Tổng đơn hàng</th>
                                                                        <th style="width: 30% ">Trạng thái</th>
                                                                        <th style="width: 15% ">Vận chuyển</th>
                                                                        <th style="width: 15% ">Thao tác</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr>
                                                                        @{
                                                                            var billDetails = (from bd in _db.BillDetails
                                                                                               where bd.IDBill == s.IDBill
                                                                                               select bd).ToList();
                                                                            foreach (var bd in billDetails)
                                                                            {
                                                                                var dish = _db.Menus.SingleOrDefault(n => n.DishName == bd.DishName);
                                                                                if (dish != null)
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="../@dish.Image" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="~/images/chao-hanh.jpg" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                            }
                                                                            var orderState = (from os in _db.OrderStates
                                                                                              join ot in _db.OrderTracks on os.IDOrderStatse equals ot.IDOrderStatse
                                                                                              where ot.IDBill == s.IDBill
                                                                                              select os.StateName).SingleOrDefault();
                                                                            <td class="text-center">@s.Total</td>
                                                                            <td class="text-center">@orderState</td>
                                                                            <td class="text-center">Giao tiêu chuẩn</td>
                                                                            <td class="text-center">
                                                                                <a href="/OrderManagement/InformationProducts" class="detail">Xem chi tiết</a>
                                                                                <button class="button-sale">Mua lần nữa</button>
                                                                                <button class="button-sale">Hủy</button>
                                                                            </td>
                                                                        }
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            <div class="table-top">
                                                                <div class="table-top-user"><i class="fa fa-user-circle-o">@user.Username</i></div>
                                                                <div class="table-top-products">@s.IDBill</div>
                                                            </div>
                                                        </div>
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            </div>
                        </div>
                    </div>
                    <!--Tab Hoàn Tiền-->
                    <div class="tabcontent" id="Refund">
                        <div class="tabcontent-top-search">
                            <div class="tabcontent-container">
                                <div class="search-border">
                                    <i class="fa fa-search"></i>
                                    @{

                                        if (input != null)
                                        {
                                            <input class="search" type="text" placeholder="Tìm theo tên sản phẩm, ID đơn hàng" value="@input" />
                                        }
                                        else
                                        {
                                            <input class="search" type="text" placeholder="Tìm theo tên sản phẩm, ID đơn hàng" />
                                        }
                                    }
                                </div>
                            </div>
                        </div>
                        <div class="tabcontent-all-bottom">
                            <div class="tabcontent-all-bottom-products">
                                @{
                                    if (user != null)
                                    {
                                        var role = _db.User_Roles.SingleOrDefault(n => n.IDUser == user.IDUser);
                                        //Administrator
                                        if (role.IDRole == "R01")
                                        {
                                            foreach (var s in Model)
                                            {
                                                OrderTrack orderTrack = _db.OrderTracks.SingleOrDefault(n => n.IDBill == s.IDBill && n.IDOrderStatse == "OS-06");
                                                if (orderTrack != null)
                                                {
                                                    <div class="tabcontent-all-bottom-left">
                                                        <table>
                                                            <thead>
                                                                <tr>
                                                                    <th style="width: 30% "><i class="fa fa-info-circle"></i>Thông tin sản phẩm</th>
                                                                    <th style="width: 10% ">Tổng đơn hàng</th>
                                                                    <th style="width: 22.5% ">Trạng thái</th>
                                                                    <th style="width: 22.5% ">Vận chuyển</th>
                                                                    <th style="width: 15% ">Thao tác</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                <tr>
                                                                    @{
                                                                        var BillDetails = (from bd in _db.BillDetails
                                                                                           where bd.IDBill == s.IDBill
                                                                                           select bd).ToList();
                                                                        foreach (var bd in BillDetails)
                                                                        {
                                                                            var dish = _db.Menus.SingleOrDefault(n => n.DishName == bd.DishName);
                                                                            if (dish != null)
                                                                            {
                                                                                <td class="display-infor">
                                                                                    <img src="../@dish.Image" />
                                                                                    <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                </td>
                                                                            }
                                                                            else
                                                                            {
                                                                                <td class="display-infor">
                                                                                    <img src="~/images/chao-hanh.jpg" />
                                                                                    <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                </td>
                                                                            }
                                                                        }
                                                                        var orderState = (from os in _db.OrderStates
                                                                                          join ot in _db.OrderTracks on os.IDOrderStatse equals ot.IDOrderStatse
                                                                                          where ot.IDBill == s.IDBill
                                                                                          select os.StateName).SingleOrDefault();
                                                                        <td class="text-center">@s.Total</td>
                                                                        <td class="text-center">@orderState</td>
                                                                        <td class="text-center">Giao tiêu chuẩn</td>
                                                                        <td class="text-center">
                                                                            <a href="/OrderManagement/InformationProducts" class="detail">Xem chi tiết</a>
                                                                            <button class="button-sale">Mua lần nữa</button>
                                                                            <a href="#" class="detail">Chuyển state</a>
                                                                        </td>
                                                                    }
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                        @{
                                                            var usertemp = (from u in _db.Users
                                                                            where u.IDUser == s.IDUser
                                                                            select u).SingleOrDefault();
                                                            <div class="table-top">
                                                                <div class="table-top-user"><i class="fa fa-user-circle-o">@usertemp.Username</i></div>
                                                                <div class="table-top-products">@s.IDBill</div>
                                                            </div>
                                                        }
                                                    </div>
                                                }
                                            }
                                        }
                                        //Seller
                                        else if (role.IDRole == "R02")
                                        {
                                            foreach (var s in Model)
                                            {
                                                OrderTrack orderTrack = _db.OrderTracks.SingleOrDefault(n => n.IDBill == s.IDBill && n.IDOrderStatse == "OS-06");
                                                if (orderTrack != null)
                                                {
                                                    var bill = (from b in _db.Bills
                                                                join sto in _db.Stores on b.IDStore equals sto.IDStore
                                                                where sto.IDUser == user.IDUser && b.IDBill == s.IDBill
                                                                select b).SingleOrDefault();
                                                    if (bill != null)
                                                    {
                                                        <div class="tabcontent-all-bottom-left">
                                                            <table>
                                                                <thead>
                                                                    <tr>
                                                                        <th style="width: 30% "><i class="fa fa-info-circle"></i>Thông tin sản phẩm</th>
                                                                        <th style="width: 10% ">Tổng đơn hàng</th>
                                                                        <th style="width: 22.5% ">Trạng thái</th>
                                                                        <th style="width: 22.5% ">Vận chuyển</th>
                                                                        <th style="width: 15% ">Thao tác</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr>
                                                                        @{
                                                                            var BillDetails = (from bd in _db.BillDetails
                                                                                               where bd.IDBill == s.IDBill
                                                                                               select bd).ToList();
                                                                            foreach (var bd in BillDetails)
                                                                            {
                                                                                var dish = _db.Menus.SingleOrDefault(n => n.DishName == bd.DishName);
                                                                                if (dish != null)
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="../@dish.Image" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="~/images/chao-hanh.jpg" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                            }
                                                                            var orderState = (from os in _db.OrderStates
                                                                                              join ot in _db.OrderTracks on os.IDOrderStatse equals ot.IDOrderStatse
                                                                                              where ot.IDBill == s.IDBill
                                                                                              select os.StateName).SingleOrDefault();
                                                                            <td class="text-center">@s.Total</td>
                                                                            <td class="text-center">@orderState</td>
                                                                            <td class="text-center">Giao tiêu chuẩn</td>
                                                                            <td class="text-center">
                                                                                <a href="/OrderManagement/InformationProducts" class="detail">Xem chi tiết</a>
                                                                                <button class="button-sale">Mua lần nữa</button>
                                                                                <a href="#" class="detail">Chuyển state</a>
                                                                            </td>
                                                                        }
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            @{
                                                                var usertemp = (from u in _db.Users
                                                                                where u.IDUser == s.IDUser
                                                                                select u).SingleOrDefault();
                                                                <div class="table-top">
                                                                    <div class="table-top-user"><i class="fa fa-user-circle-o">@usertemp.Username</i></div>
                                                                    <div class="table-top-products">@s.IDBill</div>
                                                                </div>
                                                            }
                                                        </div>
                                                    }
                                                }
                                            }
                                        }
                                        //Customers
                                        else if (role.IDRole == "R03")
                                        {
                                            foreach (var s in Model)
                                            {
                                                OrderTrack orderTrack = _db.OrderTracks.SingleOrDefault(n => n.IDBill == s.IDBill && n.IDOrderStatse == "OS-06");
                                                if (orderTrack != null)
                                                {
                                                    if (s.IDUser == user.IDUser)
                                                    {
                                                        <div class="tabcontent-all-bottom-left">
                                                            <table>
                                                                <thead>
                                                                    <tr>
                                                                        <th style="width: 30% "><i class="fa fa-info-circle"></i>Thông tin sản phẩm</th>
                                                                        <th style="width: 10% ">Tổng đơn hàng</th>
                                                                        <th style="width: 30% ">Trạng thái</th>
                                                                        <th style="width: 15% ">Vận chuyển</th>
                                                                        <th style="width: 15% ">Thao tác</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody>
                                                                    <tr>
                                                                        @{
                                                                            var billDetails = (from bd in _db.BillDetails
                                                                                               where bd.IDBill == s.IDBill
                                                                                               select bd).ToList();
                                                                            foreach (var bd in billDetails)
                                                                            {
                                                                                var dish = _db.Menus.SingleOrDefault(n => n.DishName == bd.DishName);
                                                                                if (dish != null)
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="../@dish.Image" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <td class="display-infor">
                                                                                        <img src="~/images/chao-hanh.jpg" />
                                                                                        <div class="text-information">@bd.DishName x @bd.Quantity</div>
                                                                                    </td>
                                                                                }
                                                                            }
                                                                            var orderState = (from os in _db.OrderStates
                                                                                              join ot in _db.OrderTracks on os.IDOrderStatse equals ot.IDOrderStatse
                                                                                              where ot.IDBill == s.IDBill
                                                                                              select os.StateName).SingleOrDefault();
                                                                            <td class="text-center">@s.Total</td>
                                                                            <td class="text-center">@orderState</td>
                                                                            <td class="text-center">Giao tiêu chuẩn</td>
                                                                            <td class="text-center">
                                                                                <a href="/OrderManagement/InformationProducts" class="detail">Xem chi tiết</a>
                                                                                <button class="button-sale">Mua lần nữa</button>
                                                                                <button class="button-sale">Hủy</button>
                                                                            </td>
                                                                        }
                                                                    </tr>
                                                                </tbody>
                                                            </table>
                                                            <div class="table-top">
                                                                <div class="table-top-user"><i class="fa fa-user-circle-o">@user.Username</i></div>
                                                                <div class="table-top-products">@s.IDBill</div>
                                                            </div>
                                                        </div>
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</body>
<script src="~/Scripts/jquery-3.5.1.min.js"></script>
<script src="~/Scripts/OrderManagement.js"></script>
